{"version":3,"file":"_server-CmSUGEai.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/players/_server.js"],"sourcesContent":["import { d as db, p as players, a as matchParticipants, m as matches } from \"../../../../chunks/schema.js\";\nimport { json } from \"@sveltejs/kit\";\nimport { eq, sql } from \"drizzle-orm\";\nasync function POST({ request }) {\n  const player = await request.json();\n  await db.insert(players).values(player);\n  return json({ success: true });\n}\nasync function DELETE({ request }) {\n  const { id } = await request.json();\n  await db.delete(players).where(eq(players.id, id));\n  return json({ success: true });\n}\nasync function GET() {\n  const sq = db.select({\n    id: players.id,\n    name: players.name,\n    matchesWon: sql`SUM(\n                CASE\n                    WHEN (${matchParticipants.team} = 'A' AND ${matches.teamAScore} > ${matches.teamBScore}) OR\n                         (${matchParticipants.team} = 'B' AND ${matches.teamBScore} > ${matches.teamAScore})\n                    THEN 1\n                    ELSE 0\n                END\n            )`.as(\"matchesWon\"),\n    matchesDrawn: sql`SUM(\n                CASE\n                    WHEN ${matches.teamAScore} = ${matches.teamBScore} THEN 1\n                    ELSE 0\n                END\n            )`.as(\"matchesDrawn\"),\n    matchesLost: sql`SUM(\n                CASE\n                    WHEN (${matchParticipants.team} = 'A' AND ${matches.teamAScore} < ${matches.teamBScore}) OR\n                         (${matchParticipants.team} = 'B' AND ${matches.teamBScore} < ${matches.teamAScore})\n                    THEN 1\n                    ELSE 0\n                END\n            )`.as(\"matchesLost\"),\n    goalsFor: sql`SUM(\n                CASE\n                    WHEN ${matchParticipants.team} = 'A' THEN ${matches.teamAScore}\n                    WHEN ${matchParticipants.team} = 'B' THEN ${matches.teamBScore}\n                    ELSE 0\n                END\n            )`.as(\"goalsFor\"),\n    goalsAgainst: sql`SUM(\n                CASE\n                    WHEN ${matchParticipants.team} = 'A' THEN ${matches.teamBScore}\n                    WHEN ${matchParticipants.team} = 'B' THEN ${matches.teamAScore}\n                    ELSE 0\n                END\n            )`.as(\"goalsAgainst\")\n  }).from(players).leftJoin(matchParticipants, eq(players.id, matchParticipants.playerId)).leftJoin(matches, eq(matches.id, matchParticipants.matchId)).groupBy(players.id).orderBy(players.name).as(\"sq\");\n  const allPlayers = await db.select({\n    id: sq.id,\n    name: sq.name,\n    matchesWon: sq.matchesWon,\n    matchesDrawn: sq.matchesDrawn,\n    matchesLost: sq.matchesLost,\n    goalsFor: sq.goalsFor,\n    goalsAgainst: sq.goalsAgainst,\n    totalMatches: sql`${sq.matchesWon} + ${sq.matchesDrawn} + ${sq.matchesLost}`.as(\n      \"totalMatches\"\n    ),\n    victoryPercentage: sql`CASE\n                WHEN (${sq.matchesWon} + ${sq.matchesDrawn} + ${sq.matchesLost}) = 0 THEN 0\n                ELSE ROUND((${sq.matchesWon} * 100.0) / (${sq.matchesWon} + ${sq.matchesDrawn} + ${sq.matchesLost}), 2)\n            END`.as(\"victoryPercentage\")\n  }).from(sq).orderBy(sq.name);\n  return json(allPlayers);\n}\nexport {\n  DELETE,\n  GET,\n  POST\n};\n"],"names":[],"mappings":"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"}